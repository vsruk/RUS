# .github/workflows/cppcheck.yml

# Name of the workflow
name: Cppcheck Static Analysis

# Controls when the workflow will run
on:
  # Triggers the workflow on push events but only for the main branch
  push:
    branches: [ main ]
  # Triggers the workflow on pull request events but only for the main branch
  pull_request:
    branches: [ main ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "cppcheck"
  cppcheck:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - name: Checkout repository
        uses: actions/checkout@v4

      # Install cppcheck using the package manager
      - name: Install cppcheck
        run: |
          sudo apt-get update
          sudo apt-get install -y cppcheck

      # Debugging: List files in workspace to verify path to Lab1
      - name: List files in workspace
        run: ls -la

      # Run cppcheck
      - name: Run cppcheck analysis
        run: |
          if [ -d "Lab1" ]; then
            cppcheck \
              --enable=all \
              --inconclusive \
              --std=c99 \
              --error-exitcode=1 \
              --suppress=missingIncludeSystem \
              --verbose \
              "Lab1" 2> cppcheck-report.txt
          else
            echo "Directory Lab1 does not exist!"
            exit 1
          fi

      # Upload cppcheck report as artifact
      - name: Upload cppcheck report
        uses: actions/upload-artifact@v3
        with:
          name: cppcheck-report
          path: cppcheck-report.txt
